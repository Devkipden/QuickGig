<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QuickGigs Kenya – Safe Gigs for All Ages (Youth, Elderly, Everyone)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
  <!-- PWA Manifest -->
  <link rel="manifest" href="data:application/manifest+json,{
    \"name\":\"QuickGigs Kenya\",
    \"short_name\":\"QuickGigs\",
    \"start_url\":\".\",
    \"display\":\"standalone\",
    \"background_color\":\"#0a0a0a\",
    \"theme_color\":\"#aaff00\",
    \"icons\":[{\"src\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==\",\"sizes\":\"192x192\",\"type\":\"image/png\"}]
  }">
  <style>
    :root {
      --lime: #aaff00;
      --pink: #ff0099;
      --black: #0a0a0a;
      --gray: #1a1a1a;
      --safe-blue: #0077cc;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: var(--black);
      color: white;
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
    }
    .container { max-width: 420px; margin: 0 auto; padding: 1rem; }
    header { text-align: center; padding: 2rem 0; }
    .logo { font-family: 'Space Grotesk', sans-serif; font-size: 2.2rem; color: var(--lime); }
    .tagline { font-size: 1.1rem; margin: 0.5rem 0 1.5rem; color: #aaa; }
    .timer { background: var(--lime); color: var(--black); padding: 0.8rem; border-radius: 12px; font-weight: 700; text-align: center; margin: 1rem 0; font-size: 1.3rem; }
    .btn { background: var(--lime); color: var(--black); border: none; padding: 1rem; font-size: 1.1rem; font-weight: 700; border-radius: 12px; width: 100%; margin: 0.8rem 0; cursor: pointer; transition: 0.2s; }
    .btn:hover { transform: scale(1.02); }
    .btn-pink { background: var(--pink); color: white; }
    .btn-blue { background: var(--safe-blue); color: white; }
    .form-group { margin: 1rem 0; }
    label { display: block; margin-bottom: 0.4rem; font-size: 0.9rem; color: #ccc; }
    input, textarea, select { width: 100%; padding: 0.9rem; border: 2px solid #333; border-radius: 10px; background: var(--gray); color: white; font-size: 1rem; }
    .examples { background: #111; padding: 1rem; border-radius: 12px; margin: 1.5rem 0; font-size: 0.9rem; }
    .example { margin: 0.6rem 0; padding-left: 1.5rem; position: relative; }
    .example::before { content: "Timer"; position: absolute; left: 0; }
    footer { text-align: center; padding: 2rem 0; color: #666; font-size: 0.8rem; }
    .countdown { font-family: monospace; font-size: 1.5rem; }
    .hidden { display: none; }
    .warning { background: #330000; border: 1px solid #f66; padding: 0.8rem; border-radius: 8px; margin: 1rem 0; font-size: 0.85rem; }
    .safety-badge { background: var(--safe-blue); color: white; padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 0.7rem; font-weight: 700; }

    /* GIG FEED */
    #gig-feed { display:flex; flex-direction:column; gap:1rem; margin-top:1rem; }
    .gig-card { background:#111; padding:1rem; border-radius:12px; border:1px solid #333; font-size:0.95rem; }
    .gig-title { font-weight:700; color:var(--lime); margin-bottom:0.4rem; }
    .gig-loc { color:#ccc; font-size:0.85rem; margin:0.4rem 0; }
    .gig-details { color:#aaa; font-size:0.8rem; line-height:1.4; }
    .gig-footer { margin-top:0.8rem; display:flex; justify-content:space-between; align-items:center; }
    .gig-pay { color:var(--pink); font-weight:600; }
    .gig-claim { background:var(--lime); color:black; padding:0.4rem 0.8rem; border-radius:8px; font-size:0.8rem; text-decoration:none; }

    /* Age & Safety */
    .age-group { display: flex; gap: 0.5rem; margin: 0.8rem 0; }
    .age-btn { flex: 1; padding: 0.8rem; background: #222; border: 1px solid #444; border-radius: 8px; text-align: center; cursor: pointer; }
    .age-btn.selected { background: var(--lime); color: black; font-weight: 700; }

    /* PWA Install */
    #install-btn { position:fixed; bottom:1rem; left:50%; transform:translateX(-50%); z-index:100; }
  </style>
</head>
<body>

<div class="container">
  <!-- HEADER -->
  <header>
    <div class="logo">QuickGigs KE</div>
    <p class="tagline">Safe 15-min gigs for <strong>Youth • Adults • Seniors</strong></p>
    <div class="timer">Gigs expire in <span id="countdown">15:00</span></div>
  </header>

  <!-- AGE GROUP SELECTION (NEW) -->
  <div style="margin:1.5rem 0;">
    <p style="font-size:0.9rem; color:#ccc; margin-bottom:0.5rem;">Who are you?</p>
    <div class="age-group">
      <div class="age-btn" data-age="youth" onclick="selectAge(this)">Youth (16–30)</div>
      <div class="age-btn" data-age="adult" onclick="selectAge(this)">Adult (31–59)</div>
      <div class="age-btn" data-age="senior" onclick="selectAge(this)">Senior (60+)</div>
    </div>
  </div>

  <!-- HERO CTA -->
  <button class="btn" onclick="checkAgeAndScroll('post-form')">
    Post a Safe Gig
  </button>
  <button class="btn btn-pink" onclick="checkAgeAndScroll('gig-feed-section')">
    Browse Safe Gigs
  </button>

  <!-- SAFETY WARNING -->
  <div class="warning">
    <strong>Safety First:</strong> All users must be 18+. Meet in public. No personal info. Report issues.
  </div>

  <!-- EXAMPLES (Inclusive) -->
  <div class="examples">
    <p><strong>Safe gigs for all:</strong></p>
    <div class="example">KSh 300 – Help carry groceries (senior-friendly)</div>
    <div class="example">KSh 200 – Teach phone basics to grandma</div>
    <div class="example">KSh 400 – Film family reunion</div>
    <div class="example">KSh 150 – Deliver medicine (with ID)</div>
  </div>

  <!-- POST GIG FORM (WITH CONSENT) -->
  <div id="post-form" class="hidden">
    <h2 style="font-size:1.3rem; margin:1.5rem 0 1rem;">Post a Safe Gig</h2>

    <!-- Consent Checkbox -->
    <div style="margin:1rem 0; padding:0.8rem; background:#111; border-radius:8px;">
      <label style="display:flex; align-items:center; gap:0.5rem; font-size:0.9rem;">
        <input type="checkbox" id="consent" required style="width:auto; transform:scale(1.3);" />
        I am 16+, agree to meet in public, and will not share personal info.
      </label>
    </div>

    <form id="gig-form" action="https://formspree.io/f/mwpwrdon" method="POST">
      <input type="hidden" name="age_group" id="age_group_input" />
      <div class="form-group">
        <label>Title (e.g., "KSh 300 to help carry bags at Westgate")</label>
        <input type="text" name="title" required placeholder="Include price + public meetup" />
      </div>
      <div class="form-group">
        <label>Location (auto-detected)</label>
        <input type="text" id="location" name="location" readonly />
      </div>
      <div class="form-group">
        <label>Details (max 100 chars)</label>
        <textarea name="details" rows="2" maxlength="100" placeholder="Meet at Java House entrance. Pay via M-Pesa."></textarea>
      </div>
      <div class="form-group">
        <label>M-Pesa Number</label>
        <input type="text" name="payment" required placeholder="07xx..." />
      </div>
      <div class="form-group">
        <label>Contact (WhatsApp/Call)</label>
        <input type="text" name="contact" required placeholder="07xx..." />
      </div>
      <button type="submit" class="btn">Post Gig – FREE</button>
    </form>
  </div>

  <!-- SUCCESS -->
  <div id="success" class="hidden" style="background:var(--lime); color:var(--black); padding:1.5rem; border-radius:12px; text-align:center; margin:1.5rem 0;">
    <strong>Gig posted safely!</strong><br>Check live feed below.
  </div>

  <!-- LIVE GIG FEED (WITH VERIFIED BADGE) -->
  <div id="gig-feed-section" class="hidden" style="margin-top:2rem;">
    <h2 style="font-size:1.3rem; margin:1.5rem 0 1rem; text-align:center;">
      Live Safe Gigs Near You
    </h2>
    <div id="gig-feed">
      <p style="text-align:center; color:#888;">Loading safe gigs...</p>
    </div>
  </div>

  <footer>
    <p>© 2025 QuickGigs Kenya • <a href="#" style="color:var(--lime);">Report Issue</a></p>
  </footer>
</div>

<!-- PWA Install Button -->
<button id="install-btn" class="btn hidden">Install App</button>

<script>
  // ---------- CONFIG: REPLACE WITH YOUR NEW SHEETDB URL ----------
  const SHEETDB_API = "https://sheetdb.io/api/v1/r20c3ysw8j287";

  let selectedAge = null;

  // Age Selection
  function selectAge(btn) {
    document.querySelectorAll('.age-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    selectedAge = btn.dataset.age;
    document.getElementById('post-form').classList.remove('hidden');
    document.getElementById('gig-feed-section').classList.remove('hidden');
  }

  function checkAgeAndScroll(id) {
    if (!selectedAge) {
      alert('Please select your age group first.');
      return;
    }
    document.getElementById(id).scrollIntoView({behavior: 'smooth'});
  }

  // 15-Min Countdown
  let seconds = 15 * 60;
  const countdownEl = document.getElementById('countdown');
  setInterval(() => {
    seconds--;
    const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
    const secs = (seconds % 60).toString().padStart(2, '0');
    countdownEl.textContent = `${mins}:${secs}`;
    if (seconds <= 0) seconds = 15 * 60;
  }, 1000);

  // Location
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      const { latitude, longitude } = pos.coords;
      fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`)
        .then(r => r.json())
        .then(data => {
          document.getElementById('location').value = `${data.city || 'Nairobi'}, Kenya`;
        });
    });
  }

  // Form Submit
  document.getElementById('gig-form').addEventListener('submit', function (e) {
    if (!document.getElementById('consent').checked) {
      e.preventDefault();
      alert('You must agree to safety terms.');
      return;
    }
    document.getElementById('age_group_input').value = selectedAge;
    setTimeout(() => {
      document.getElementById('post-form').style.display = 'none';
      document.getElementById('success').classList.remove('hidden');
      loadGigs();
    }, 600);
  });

  // LIVE GIG FEED
  function loadGigs() {
    if (!SHEETDB_API.includes('sheetdb.io')) {
      document.getElementById('gig-feed').innerHTML = `<p style="color:#f66;">Add SheetDB URL in code!</p>`;
      return;
    }

    fetch(SHEETDB_API)
      .then(r => r.json())
      .then(data => {
        const feed = document.getElementById('gig-feed');
        feed.innerHTML = '';
        const now = Date.now();
        const fifteenMins = 15 * 60 * 1000;

        data.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp));
        let shown = 0;

        data.forEach(gig => {
          const ts = new Date(gig.Timestamp).getTime();
          if (now - ts > fifteenMins) return;

          const card = document.createElement('div');
          card.className = 'gig-card';

          const ageBadge = gig.age_group ? 
            `<span class="safety-badge">${gig.age_group.toUpperCase()}</span>` : 
            `<span class="safety-badge">ALL</span>`;

          const phone = (gig.contact || gig.Contact || '').match(/07\d{8}/)?.[0] || '07xx';

          card.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:start;">
              <div class="gig-title">${gig.Title || 'Untitled'}</div>
              ${ageBadge}
            </div>
            <div class="gig-loc">Location: ${gig.Location || 'Nairobi'}</div>
            <div class="gig-details">${gig.Details || ''}</div>
            <div class="gig-footer">
              <span class="gig-pay">KSh ${gig.Payment || '200'}</span>
              <a href="https://wa.me/254${phone.slice(1)}" class="gig-claim">WhatsApp</a>
            </div>
          `;
          feed.appendChild(card);
          shown++;
        });

        if (shown === 0) {
          feed.innerHTML = `<p style="text-align:center; color:#666;">No safe gigs. Post one!</p>`;
        }
      })
      .catch(() => {
        document.getElementById('gig-feed').innerHTML = `<p style="color:#f66;">Check internet or SheetDB URL.</p>`;
      });
  }

  loadGigs();
  setInterval(loadGigs, 15000);

  // PWA Install
  let deferredPrompt;
  const installBtn = document.getElementById('install-btn');
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.classList.remove('hidden');
  });
  installBtn.addEventListener('click', () => {
    installBtn.classList.add('hidden');
    deferredPrompt.prompt();
  });
</script>

</body>
</html>
